# Journalyst

This README explains the environment variables, run commands, and the project path structure for the Journalyst project.

**Quick summary**
- Runtime: Node.js + TypeScript
- Dev runner: `nodemon` + `ts-node`
- Build: `tsc` -> `dist`
- Main entry (dev): `src/app.ts` (nodemon); production: `dist/app.js`

**Required .env variables**
Create a `.env` file in the project root with at least the following keys:

```
# Kite Connect credentials
API_KEY=your_kite_api_key_here
API_SECRET_KEY=your_kite_api_secret_here
```

Notes:
- Both `API_KEY` and `API_SECRET_KEY` are read by `src/adapter/kiteConnect.ts`.
- Put the `.env` file in the repository root (same level as `package.json`) so `dotenv.config()` in `src/app.ts` and other files will pick it up.

**Install dependencies**
Run this once to install packages:

```powershell
npm install
```

**Available npm scripts**
- `npm run dev` — run in development mode (nodemon + ts-node). Uses `nodemon.json` configuration and runs `ts-node ./src/app.ts`.
- `npm run build` — compile TypeScript to JavaScript into the `dist/` folder using `tsc`.
- `npm run start` — run the compiled app with `node dist/app.js` (production path after build).

Example dev workflow:

```powershell
# set env variables in .env then
npm install
npm run dev
```

Example production workflow:

```powershell
# set env variables in .env
npm install --production
npm run build
npm run start
```

**Server endpoints and usage**
- `GET /login`
  - Redirects the user to KiteConnect login page (generated by the `kc` instance).
  - No request body required.

- `GET /redirecturl`
  - This is the callback that KiteConnect will redirect to after user login.
  - Expects a query parameter `request_token` (example: `/redirecturl?request_token=...`).
  - Handler: `src/services/GetAccessToken.ts` — generates session, saves access token into the in-memory token store.

- `GET /sync` (internal API)
  - Expects a JSON body with:
    - `user_id` — user identifier used to locate saved access token
    - `broker_name` — broker key used to pick a normalizer (e.g., `zerodha`)
  - It fetches trades using the stored access token and returns normalized trades.
  - Handler: `src/services/SyncTrades.ts`.

- `POST /logout`
  - Expects a JSON body with `user_id`.
  - It invalidates the user's access token via the KiteConnect client and removes it from the in-memory token store.

**Important implementation notes / caveats**
- Token storage is currently in-memory (`src/utility/tokeStore.ts`) as a simple object. This is not persistent and not safe for production.
- The server listens on port `3000` (hardcoded in `src/app.ts`). You can change to use `process.env.PORT` if you want configurable ports.
- The code assumes `kc.getTrades()` returns an array —(I imagine because I don't have trades in zerodha unable to verify) ensure KiteConnect returns the expected structure or add defensive checks.


